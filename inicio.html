<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solicitud de Máquina Virtual</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-7xl mx-auto">
        <h1 class="text-3xl font-bold mb-8 text-center">Generador de Script para VM en Azure VMware Services</h1>
        <div class="flex flex-col md:flex-row gap-8">
            <!-- Columna izquierda: Formulario -->
            <div class="w-full md:w-1/2 bg-white rounded-xl shadow-md overflow-hidden">
                <div class="p-8">
                    <h2 class="text-xl font-semibold mb-4">Solicitud de Máquina Virtual</h2>
                    <form id="vmForm" class="space-y-4">
                        <div>
                            <label for="vmCount" class="block text-sm font-medium text-gray-700">Cantidad de servidores:</label>
                            <input type="number" id="vmCount" name="vmCount" min="1" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
                        </div>
                        <!-- Tabla dinámica para poblar valores según la cantidad de servidores -->
                        <div id="dynamicTableContainer" class="hidden">
                            <table class="min-w-full bg-white mt-4">
                                <thead>
                                    <tr>
                                        <th class="px-6 py-3 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-600 uppercase tracking-wider">Servidor</th>
                                        <th class="px-6 py-3 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-600 uppercase tracking-wider">Nombre</th>
                                        <th class="px-6 py-3 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-600 uppercase tracking-wider">Cores</th>
                                        <th class="px-6 py-3 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-600 uppercase tracking-wider">Memoria</th>
                                        <th class="px-6 py-3 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-600 uppercase tracking-wider">SO</th>
                                    </tr>
                                </thead>
                                <tbody id="dynamicTable">
                                    <!-- Filas dinámicas generadas aquí -->
                                </tbody>
                            </table>
                        </div>

                        <div>
                            <label for="os" class="block text-sm font-medium text-gray-700">Sistema Operativo:</label>
                            <select id="os" name="os" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
                                <option value="">Seleccione SO</option>
                                <option value="Windows">Windows Server</option>
                                <option value="Linux">Linux</option>
                            </select>
                        </div>
                        <div>
                            <label for="storage" class="block text-sm font-medium text-gray-700">Almacenamiento (GB):</label>
                            <input type="number" id="storage" name="storage" min="1" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
                        </div>
                        <div>
                            <label for="memory" class="block text-sm font-medium text-gray-700">Memoria RAM (GB):</label>
                            <input type="number" id="memory" name="memory" min="1" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
                        </div>
                        <div>
                            <label for="software" class="block text-sm font-medium text-gray-700">Software adicional:</label>
                            <textarea id="software" name="software" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"></textarea>
                        </div>
                        <div>
                            <button type="submit" class="w-full bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                                Generar Script
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Columna derecha: Instrucciones y botón de descarga -->
            <div class="w-full md:w-1/2 bg-white rounded-xl shadow-md overflow-hidden">
                <div class="p-8">
                    <h2 class="text-xl font-semibold mb-4">Instrucciones de Ejecución</h2>
                    <ol class="list-decimal list-inside space-y-2 mb-6">
                        <li>Genera el script utilizando el formulario de la izquierda.</li>
                        <li>Copia el script generado o descárgalo como archivo .ps1.</li>
                        <li>Abre PowerShell como administrador.</li>
                        <li>Asegúrate de tener instalado el módulo Az.VMware:</li>
                        <pre class="bg-gray-100 p-2 rounded mt-2 mb-2">Install-Module -Name Az.VMware -Force</pre>
                        <li>Ejecuta el script con el siguiente comando (reemplaza &lt;ruta_del_script&gt; con la ubicación real del archivo):</li>
                        <pre class="bg-gray-100 p-2 rounded mt-2">.\&lt;ruta_del_script&gt;\Create-AzureVMwareVMs.ps1</pre>
                    </ol>
                    <div id="downloadSection" class="hidden">
                        <h3 class="text-lg font-semibold mb-2">Descargar Script</h3>
                        <button id="downloadButton" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                            Descargar Script PowerShell
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para mostrar el script -->
    <div id="scriptModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden">
        <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white">
            <div class="mt-3 text-center">
                <h3 class="text-lg leading-6 font-medium text-gray-900">Script PowerShell Generado</h3>
                <div class="mt-2 px-7 py-3">
                    <pre id="modalScriptContent" class="bg-gray-100 p-4 rounded overflow-x-auto text-left"></pre>
                </div>
                <div class="items-center px-4 py-3">
                    <button id="closeModal" class="px-4 py-2 bg-blue-500 text-white text-base font-medium rounded-md w-full shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-300">
                        Cerrar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('vmCount').addEventListener('change', function() {
            const vmCount = parseInt(this.value);
            const dynamicTableContainer = document.getElementById('dynamicTableContainer');
            const dynamicTable = document.getElementById('dynamicTable');

            // Limpiar la tabla antes de añadir nuevas filas
            dynamicTable.innerHTML = '';

            if (vmCount > 0) {
                dynamicTableContainer.classList.remove('hidden');

                for (let i = 1; i <= vmCount; i++) {
                    const row = document.createElement('tr');
                    
                    row.innerHTML = `
                        <td class="border px-6 py-4">Servidor ${i}</td>
                        <td class="border px-6 py-4"><input type="text" name="vmName${i}" required class="block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"></td>
                        <td class="border px-6 py-4"><input type="number" name="cores${i}" min="1" required class="block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"></td>
                        <td class="border px-6 py-4"><input type="number" name="memory${i}" min="1" required class="block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"></td>
                        <td class="border px-6 py-4"><input type="text" name="os${i}" required class="block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"></td>
                    `;

                    dynamicTable.appendChild(row);
                }
            } else {
                dynamicTableContainer.classList.add('hidden');
            }
        });
    </script>
</body>
</html>
